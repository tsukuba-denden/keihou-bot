# Feature Specification: 気象警報に基づく登校ガイダンス表示

**Feature Branch**: `004-c-users-yuubi-school-guidance`  
**Created**: 2025-09-14  
**Status**: Draft  
**Input**: User description: 「気象警報発令時の授業ルールに基づき、該当する場合何時に登校すればいいかを表示するようにして」

---

## 背景と目的
学校が公開している「気象警報発令時の授業」ルール（東京23区のいずれかに暴風雪・大雨・洪水・暴風・大雪の“警報”が発令されているかどうかを、6時／8時／10時の時点で判定）に基づき、当日の登校可否や登校時刻（該当する場合）をわかりやすく案内する。既存の気象警報通知に加えて、保護者・生徒が「今日はいつ登校すれば良いのか」を即時に判断できるよう支援する。

---

## User Scenarios & Testing

### Primary User Story
- 生徒や保護者として、朝の気象警報の有無に応じて、今日の授業があるのか、あるなら何時に登校すればよいのかを、Discordの通知で素早く知りたい。

### Acceptance Scenarios
1. Given 東京23区のいずれかに対象5種の「警報」が6時時点で1つでも発令中, When 通知を見る, Then 「自宅待機」と表示される。
2. Given 6時時点ですべて解除, When 通知を見る, Then 「平常授業」と表示される。
3. Given 8時時点で対象警報が1つでも発令中かつ曜日が火〜金, When 通知を見る, Then 「自宅待機」と表示される。
4. Given 8時時点で対象警報が1つでも発令中かつ曜日が月・土, When 通知を見る, Then 「自宅学習」と表示される。
5. Given 8時時点ですべて解除, When 通知を見る, Then 「第3時限から授業」と登校目安時刻が併記される。
6. Given 10時時点で対象警報が1つでも発令中, When 通知を見る, Then 「自宅学習」と表示される。
7. Given 10時時点ですべて解除かつ曜日が火〜金, When 通知を見る, Then 「午後から授業」と登校目安時刻が併記される。
8. Given 当日、東京23区外の居住地域に警報が発令中, When 登校が遅れる/欠席, Then 遅刻・欠席扱いにしない旨の注意が案内に含まれる。

### Edge Cases
- 6時前の早朝に通知を見た場合は、6時時点の確定判定前である旨を明示し、参考情報として現時点の状況を示す。
- 6〜8時の登校中に警報が新規発令されたケースは「自宅にもどって待機」を強調して案内する。
- 「注意報」のみ（警報なし）の場合は、対象外として平常扱いと明示する。
- 同一内容の案内が短時間で重複配信されないよう、同一判定窓（6:00/8:00/10:00）内での重複送信は抑制する。

---

## Requirements

### Functional Requirements
- FR-001: システムは東京23区に対する気象警報のうち、以下5種の「警報」が1つでも発令中かを判定すること（暴風雪／大雨／洪水／暴風／大雪）。
- FR-002: 判定は当日の「6時」「8時」「10時」の時点に従うこと。現在時刻に応じて直近の判定枠（<6時→事前案内、6〜8時→6時判定、8〜10時→8時判定、≥10時→10時判定）を適用すること。
- FR-003: 6時時点で1つでも発令中なら「自宅待機」、すべて解除なら「平常授業」を案内すること。
- FR-004: 8時時点で1つでも発令中なら月・土は「自宅学習」、火〜金は「自宅待機」を案内すること。すべて解除なら「第3時限から授業」を案内し、登校目安時刻を併記すること。
- FR-005: 10時時点で1つでも発令中なら「自宅学習」を案内すること。すべて解除なら火〜金は「午後から授業」を案内し、登校目安時刻を併記すること（[NEEDS CLARIFICATION: 月・土で10時以降に解除された場合の扱いが原文に明記されていないため、現行は「自宅学習」とする想定]).
- FR-006: 「6〜8時の登校中に警報が発令された場合は自宅にもどって待機する」注意事項を案内に含めること。
- FR-007: 東京23区外の通学区域に警報が出ている生徒については、遅刻・欠席扱いにしない注意書きを案内に含めること。
- FR-008: 「注意報」は対象外とし、判定には含めないこと。特別警報は「警報以上」として同等に扱うこと。
- FR-009: Discord通知として、見出し・判定結果・根拠（時点・曜日）・（該当時）登校目安時刻を含むメッセージを配信できること。
- FR-010: 同一判定枠内での重複配信を避けるため、同一日×判定時点での最新結果を1回のみ案内すること（[NEEDS CLARIFICATION: 重複抑止の期間・粒度]).

### 非機能要件
- NFR-001: 案内文は日本語で簡潔・誤解のない表現とすること。
- NFR-002: Discord埋め込みの文字数制限を超えないこと。

### Key Entities
- SchoolGuidance（論理エンティティ）
  - attributes: decisionPoint(6時/8時/10時), weekday(月〜日), status(平常授業/自宅待機/自宅学習/第3時限から授業/午後から授業), attendTime(optional), notes(list)
  - derived from: 当日の対象警報の有無（東京23区のいずれか）と現在時刻

---

## Open Questions / Assumptions
- 解消: 第3時限開始=10:20、午後（5時限）開始=13:10、平常登校=8:10（必要に応じて環境変数で上書き可能）。
- [NEEDS CLARIFICATION] 10時時点で解除かつ月・土の扱い（原文に記載なし）。現行は「自宅学習」継続とする案。
- [NEEDS CLARIFICATION] 同一判定枠内の重複通知ポリシー（再通知条件・間隔）。

---

## Review & Acceptance Checklist

### Content Quality
- [x] 実装詳細を避け、ユーザー価値にフォーカス
- [x] 非技術者にも読める表現
- [x] 必須セクションを充足

### Requirement Completeness
- [ ] [NEEDS CLARIFICATION] が解消されている
- [x] 要件はテスト可能で曖昧性が低い
- [x] 成功条件が明確
- [x] スコープが明確
- [x] 前提・依存が明記

---

## Execution Status

- [x] User description parsed
- [x] Key concepts extracted
- [x] Ambiguities marked
- [x] User scenarios defined
- [x] Requirements generated
- [x] Entities identified
- [ ] Review checklist passed

---
