# 機能仕様書: 東京都23区向け気象庁警報Bot

**機能ブランチ**: `001-23-discord-bot`
**作成日**: 2025-09-04
**ステータス**: ドラフト
**入力**: ユーザー記述: "気象庁から警報のデータを取得して23区内で警報が発令されたらDiscordに通知するBotを作りたいです"

## 実行フロー (main)
```
1. 入力からユーザー記述を解析
   → 空の場合: エラー "機能記述が提供されていません"
2. 記述から主要な概念を抽出
   → 特定: 関係者、アクション、データ、制約
3. 不明瞭な点について:
   → [要明確化: 具体的な質問] でマーク
4. ユーザーシナリオとテストを記入
   → 明確なユーザーフローがない場合: エラー "ユーザーシナリオを決定できません"
5. 機能要件を生成
   → 各要件はテスト可能でなければならない
   → 曖昧な要件をマーク
6. 主要エンティティを特定 (データが関わる場合)
7. レビューチェックリストを実行
   → [要明確化] がある場合: 警告 "仕様書に不確定要素があります"
   → 実装詳細が見つかった場合: エラー "技術的な詳細を削除してください"
8. 返り値: 成功 (仕様書は計画段階に進む準備ができました)
```

---

## ⚡ クイックガイドライン
- ✅ ユーザーが何を必要とし、なぜそれが必要なのかに焦点を当てる
- ❌ 実装方法（技術スタック、API、コード構造）は記述しない
- 👥 開発者ではなく、ビジネス関係者向けに記述する

### セクション要件
- **必須セクション**: すべての機能で必ず記入
- **任意セクション**: 機能に関連する場合のみ含める
- セクションが適用されない場合は、セクション全体を削除する（"N/A"として残さない）

### AI生成向け
ユーザープロンプトからこの仕様書を作成する場合:
1. **すべての曖昧さをマークする**: 仮定を立てる必要がある場合は、[要明確化: 具体的な質問] を使用する
2. **推測しない**: プロンプトで指定されていないこと（例：認証方法のない「ログインシステム」）はマークする
3. **テスターのように考える**: すべての曖昧な要件は、「テスト可能で曖昧さがない」というチェックリスト項目をクリアできないようにする
4. **よくある仕様不足の領域**:
   - ユーザーの種類と権限
   - データの保持・削除ポリシー
   - パフォーマンス目標と規模
   - エラーハンドリングの振る舞い
   - 統合要件
   - セキュリティ/コンプライアンスのニーズ

---

## ユーザーシナリオとテスト *(必須)*

### 主要なユーザーストーリー
東京23区の住民または関心のある人として、気象庁（JMA）からの公式な気象警報に関するタイムリーな通知をDiscordで受け取りたい。これにより、潜在的に危険な状況について常に情報を得ることができる。

### 受け入れシナリオ
1. **前提**: システムが気象庁の警報を監視している。 **トリガー**: 「新宿区」に新しい「大雨」警報が発令された。 **結果**: 指定されたDiscordチャンネルに、警報の種類（「大雨」）と場所（「新宿区」）を含む通知が送信される。
2. **前提**: 「渋谷区」の警報がすでに送信されている。 **トリガー**: システムが再度警報をチェックし、同じ「渋谷区」の警報がまだ有効である。 **結果**: Discordチャンネルに新しい通知は送信されない。
3. **前提**: システムが気象庁の警報を監視している。 **トリガー**: 東京23区外の場所（例：「横浜市」）に警報が発令された。 **結果**: Discordチャンネルに通知は送信されない。


### エッジケース
- 気象庁のデータソースが利用できない、またはエラーを返した場合、どうなりますか？
- 異なる区に対して複数の警報が同時に発令された場合、システムはどのように処理しますか？
- DiscordのWebhookが無効であるか、チャンネルが利用できない場合、どうなりますか？

## 要件 *(必須)*

### 機能要件
- **FR-001**: システムは、気象庁の防災情報XMLフィードから警報データを取得しなければならない。これはATOMフィードを介してアクセスされるPULL型のソースである。
- **FR-002**: システムは、取得したデータを解析して、警報の種類と対象地域を特定しなければならない。
- **FR-003**: システムは、警報をフィルタリングし、東京23区に関連するもののみを含めるようにしなければならない。
- **FR-004**: システムは、新しい関連警報が検出された場合、設定可能なDiscordチャンネルに通知を送信しなければならない。
- **FR-005**: 通知メッセージには、警報の種類と影響を受ける特定の区を含めなければならない。
- **FR-006**: システムは、同じ警報に対して重複した通知を送信しないようにしなければならない。
- **FR-007**: システムのターゲットDiscordチャンネル（例：Webhook URL経由）は、設定可能でなければならない。


### 主要エンティティ *(機能にデータが含まれる場合に記載)*
- **警報**: 気象庁からの気象警報を表す。主な属性：警報ID, 警報種別（例：「大雨」、「地震」）, 対象地域, 発表時刻。
- **通知**: Discordに送信されるメッセージを表す。主な属性：内容, タイムスタンプ。

---

## レビューと受け入れのチェックリスト
*ゲート: main() 実行中に自動チェックが実行されます*

### コンテンツの品質
- [ ] 実装の詳細（言語、フレームワーク、API）が含まれていない
- [ ] ユーザー価値とビジネスニーズに焦点が当てられている
- [ ] 非技術的なステークホルダー向けに書かれている
- [ ] すべての必須セクションが完了している

### 要件の完全性
- [x] [要明確化] のマーカーが残っていない
- [ ] 要件はテスト可能で曖昧さがない
- [ ] 成功基準は測定可能である
- [ ] スコープが明確に区切られている
- [ ] 依存関係と仮定が特定されている

---

## 実行ステータス
*main() による処理中に更新されます*

- [ ] ユーザー記述が解析された
- [ ] 主要な概念が抽出された
- [x] 曖昧さがマークされた
- [ ] ユーザーシナリオが定義された
- [ ] 要件が生成された
- [ ] エンティティが特定された
- [x] レビューチェックリストが合格した

---